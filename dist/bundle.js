var e,t=require("path"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e,r=require("mime"),i=Object.freeze({subjectType:"input",force:!1,allowEmpty:!1}),o=Object.freeze({INPUT:"input",DRAG_N_DROP:"drag-n-drop"}),s={};function a(e){return"string"==typeof e?{filePath:e,encoding:"",mimeType:"",fileName:n.basename(e)}:{filePath:e.filePath,encoding:e.encoding||"",mimeType:e.mimeType||"",fileName:e.fileName||n.basename(e.filePath),fileContent:e.fileContent}}s[o.INPUT]=["change"],s[o.DRAG_N_DROP]=["dragstart","drag","dragenter","drop","change","dragleave","dragend"];var f={INVALID_SUBJECT_TYPE:{message:'"subjectType" is not valid',tip:'Please look into docs to find supported "subjectType" values'},INVALID_FORCE:{message:'"force" is not valid',tip:'Please look into docs to find supported "force" values'},INVALID_ALLOW_EMPTY:{message:'"allowEmpty" is not valid',tip:'Please look into docs to find supported "allowEmpty" values'},INVALID_FILE_ENCODING:{message:'"file encoding" is not valid',tip:'Please look into docs to find supported "encoding" values'},INVALID_FILE_PATH:{message:'"filePath" is not valid',tip:'Please look into docs to find supported "filePath" values'},INVALID_MIME_TYPE:{message:'"mimeType" is not valid',tip:'Please look into docs to find supported "mimeType" values'},INVALID_FILE:{message:"given fixture file is empty",tip:'Please make sure you provide correct file or explicitly set "allowEmpty" to true'},MISSING_FILE_NAME_OR_PATH:{message:'missing "filePath" or "fileName"',tip:'Please make sure you are passing either "filePath" or "fileName"'}},l=function(e){function t(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];e.apply(this,r),e.captureStackTrace&&e.captureStackTrace(this,t),this.name="[cypress-file-upload error]",this.message=n.message+".\n"+n.tip}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),c=Object.freeze({ASCII:"ascii",BASE64:"base64",BINARY:"binary",HEX:"hex",LATIN1:"latin1",UTF8:"utf8",UTF_8:"utf-8",UCS2:"ucs2",UCS_2:"ucs-2",UTF16LE:"utf16le",UTF_16LE:"utf-16le"}),u=Object.freeze({JSON:"json",JS:"js",COFFEE:"coffee",HTML:"html",TXT:"txt",CSV:"csv",PNG:"png",JPG:"jpg",JPEG:"jpeg",GIF:"gif",TIF:"tif",TIFF:"tiff",ZIP:"zip",PDF:"pdf",VCF:"vcf",SVG:"svg",XLS:"xls",XLSX:"xlsx",DOC:"doc",DOCX:"docx",MP3:"mp3"}),p=Object.values(c);function m(e){var t=e.filePath,n=e.fileName,r=e.encoding,i=e.mimeType,o=e.fileContent;if(r&&!p.includes(r))throw new l(f.INVALID_FILE_ENCODING);if("string"!=typeof t&&!o)throw new l(f.INVALID_FILE_PATH);if("string"!=typeof i)throw new l(f.INVALID_MIME_TYPE);if(!t&&!n)throw new l(f.MISSING_FILE_NAME_OR_PATH);return!0}var d=function(e){return e instanceof Cypress.Promise?e:(delete e.then,Cypress.Promise.resolve(e))},y={};y[c.ASCII]=function(e){return Cypress.Promise.resolve(e)},y[c.BASE64]=function(e,t){return d(Cypress.Blob.base64StringToBlob(e,t))},y[c.BINARY]=function(e,t){return d(Cypress.Blob.binaryStringToBlob(e,t))},y[c.HEX]=function(e){return Cypress.Promise.resolve(e)},y[c.LATIN1]=function(e){return Cypress.Promise.resolve(e)},y[c.UTF8]=function(e){return Cypress.Promise.resolve(e)},y[c.UTF_8]=function(e){return Cypress.Promise.resolve(e)},y[c.UCS2]=function(e){return Cypress.Promise.resolve(e)},y[c.UCS_2]=function(e){return Cypress.Promise.resolve(e)},y[c.UTF16LE]=function(e){return Cypress.Promise.resolve(e)},y[c.UTF_16LE]=function(e){return Cypress.Promise.resolve(e)};var I={};I[u.JSON]=c.UTF8,I[u.JS]=c.UTF8,I[u.COFFEE]=c.UTF8,I[u.HTML]=c.UTF8,I[u.TXT]=c.UTF8,I[u.CSV]=c.UTF8,I[u.PNG]=c.BASE64,I[u.JPG]=c.BASE64,I[u.JPEG]=c.BASE64,I[u.GIF]=c.BASE64,I[u.TIF]=c.BASE64,I[u.TIFF]=c.BASE64,I[u.ZIP]=c.BASE64,I[u.PDF]=c.UTF8,I[u.VCF]=c.UTF8,I[u.SVG]=c.UTF8,I[u.XLS]=c.BINARY,I[u.XLSX]=c.BINARY,I[u.DOC]=c.BINARY,I[u.DOCX]=c.BINARY,I[u.MP3]=c.BINARY;var T=c.UTF8;Cypress.Commands.add("attachFile",{prevSubject:!0},function(e,n,c){var p,E,P=(void 0===(p=c)&&(p={}),void 0===(E=i)&&(E={}),Object.assign({},E,p)),v=P.subjectType,C=P.force,g=P.allowEmpty;!function(e){var t=e.subjectType,n=e.force,r=e.allowEmpty;if(-1===Object.values(o).indexOf(t))throw new l(f.INVALID_SUBJECT_TYPE);if("boolean"!=typeof n)throw new l(f.INVALID_FORCE);if("boolean"!=typeof r)throw new l(f.INVALID_ALLOW_EMPTY)}({subjectType:v,force:C,allowEmpty:g});var h=(Array.isArray(n)?n:[n]).map(a).filter(m);return Cypress.cy.window({log:!1}).then(function(n){var i=C||function(e){return!("chrome"===(t=Cypress.browser).name&&t.majorVersion<73&&function(e){if(!e)throw new Error("Element cannot be empty");return Cypress.dom.isAttached(e)&&Cypress.dom.isVisible(e)}(e))||function(e){if(!e)throw new Error("Element cannot be empty");return Cypress.dom.isDetached(e)}(e);var t}(e);Cypress.Promise.all(h.map(function(e){return function(e,n){var i=e.filePath,o=e.encoding,s=e.fileName,a=e.mimeType||function(e){var n=t.extname(e).slice(1);return r.getType(n)}(i),f=o||function(e){var n=t.extname(e).slice(1);return I[n]||T}(i);return new Cypress.Promise(function(r){return function(e){var t=e.filePath,n=e.fileContent,r=e.fileEncoding;return n?d(n):Cypress.cy.fixture(t,r)}({filePath:i,fileContent:e.fileContent,fileEncoding:f}).then(function(e){return function(e){var n=e.fileName,r=e.fileContent,i=e.mimeType,o=e.window;return(0,y[e.encoding])(r,i).then(function(e){var s=e;return t.extname(n).slice(1)===u.JSON&&(s=JSON.stringify(r,null,2)),new o.File([s],n,{type:i})})}({fileContent:e,fileName:s,mimeType:a,encoding:f,window:n})}).then(r)})}(e,n)})).then(function(e){return e.map(function(e){return function(t,n){if(!n&&0===e.size)throw new l(f.INVALID_FILE);return!0}(0,g)&&e})}).then(function(t){return function(e,t){var n=t.files,r=t.subjectType,i=t.force,a=new t.window.DataTransfer;if(n.forEach(function(e){return a.items.add(e)}),r===o.INPUT){var f=e[0];f.files&&f.files.length>0&&Array.prototype.forEach.call(f.files,function(e){return a.items.add(e)}),f.files=a.files}if(i){var l=s[r],c={bubbles:!0,cancelable:!0,detail:a};try{l.forEach(function(t){var n=new CustomEvent(t,c);Object.assign(n,{dataTransfer:a}),e[0].dispatchEvent(n)})}catch(e){}}}(e,{files:t,subjectType:v,force:i,window:n}),t}).then(function(e){return Cypress.log({name:"attachFile",displayName:"FILE",message:e.reduce(function(e,t){return""+(e.length>0?e+", ":e)+t.name},"")})})}),Cypress.cy.wrap(e,{log:!1})});
//# sourceMappingURL=bundle.js.map
